<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MediaPulse - OSINT Futbol</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <link rel="icon" type="image/svg+xml" href="/static/favicon.svg">
    <link rel="manifest" href="/static/manifest.json">
    <meta name="theme-color" content="#1d9bf0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="/static/favicon.svg">
    <link rel="stylesheet" href="/static/style.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        dark: { 900: '#0a0a0a', 800: '#121212', 700: '#161616', 600: '#1a1a1a', 500: '#222222' },
                        accent: '#1d9bf0',
                        positive: '#00ba7c',
                        warning: '#ffd166',
                        negative: '#f4212e',
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-dark-900 text-gray-200 min-h-screen">

    <!-- Header -->
    <header class="bg-dark-800 border-b border-gray-800 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-3 sm:px-4 py-2 sm:py-3">
            <!-- Top row: logo + player info + actions -->
            <div class="flex items-center justify-between gap-2">
                <div class="flex items-center gap-2 sm:gap-3 min-w-0">
                    <a href="#" onclick="showPortfolio(); return false;" class="flex items-center gap-2 sm:gap-3 cursor-pointer hover:opacity-80 transition">
                        <img src="/static/favicon.svg" alt="MediaPulse" class="w-7 h-7 sm:w-8 sm:h-8 flex-shrink-0">
                        <h1 class="text-base sm:text-xl font-bold text-white whitespace-nowrap">Media<span class="text-accent">Pulse</span></h1>
                    </a>
                    <div id="scheduler-indicator" class="hidden sm:flex items-center gap-1.5 text-xs text-gray-500">
                        <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
                        <span id="scheduler-text">Auto</span>
                    </div>
                </div>
                <div id="player-header" class="hidden flex items-center gap-2 sm:gap-4 min-w-0">
                    <div id="header-photo-container" class="hidden flex-shrink-0">
                        <img id="header-photo" class="w-8 h-8 sm:w-10 sm:h-10 rounded-full object-cover border-2 border-accent" src="" alt="">
                    </div>
                    <div id="header-initials" class="hidden w-8 h-8 sm:w-10 sm:h-10 rounded-full bg-accent flex items-center justify-center text-white font-bold text-xs sm:text-sm flex-shrink-0"></div>
                    <div class="text-right min-w-0 hidden sm:block">
                        <div id="header-name" class="font-semibold text-white cursor-pointer hover:text-accent text-sm sm:text-base truncate" onclick="showPlayerSwitcher()"></div>
                        <div id="header-club" class="text-xs text-gray-500 truncate"></div>
                    </div>
                    <div id="header-tm-info" class="hidden text-right ml-1 sm:ml-2 pl-1 sm:pl-2 border-l border-gray-800">
                        <div id="header-market-value" class="text-xs sm:text-sm font-bold text-green-400"></div>
                        <div id="header-contract" class="text-xs text-gray-500 hidden sm:block"></div>
                    </div>
                </div>
                <div class="flex items-center gap-1 sm:gap-2 flex-shrink-0">
                    <button id="btn-portfolio" onclick="showPortfolio()" class="bg-dark-700 hover:bg-dark-600 text-gray-300 px-2 sm:px-3 py-2 rounded-lg text-xs sm:text-sm transition hidden border border-gray-700 touch-target" title="Vista portfolio">
                        <span class="hidden sm:inline">Portfolio</span><span class="sm:hidden">P</span>
                    </button>
                    <button id="btn-export" onclick="exportPDF()" class="bg-dark-700 hover:bg-dark-600 text-gray-300 px-2 sm:px-3 py-2 rounded-lg text-xs sm:text-sm transition hidden border border-gray-700 touch-target" title="Descargar informe">
                        PDF
                    </button>
                    <button id="btn-switch" onclick="showPlayerSwitcher()" class="bg-dark-700 hover:bg-dark-600 text-gray-300 px-2 sm:px-3 py-2 rounded-lg text-xs sm:text-sm transition hidden border border-gray-700 touch-target" title="Cambiar jugador">
                        +
                    </button>
                    <button id="btn-scan" onclick="startScan()" class="bg-accent hover:bg-blue-600 text-white px-3 sm:px-4 py-2 rounded-lg font-medium text-xs sm:text-sm transition hidden touch-target">
                        <span class="hidden sm:inline">Escanear</span><span class="sm:hidden">Scan</span>
                    </button>
                    <span id="cost-indicator" class="hidden text-[10px] text-gray-600 ml-1 cursor-help" title="Coste estimado de APIs"></span>
                    <a href="/logout" class="text-gray-600 hover:text-gray-400 text-xs ml-1 sm:ml-2 transition touch-target p-1" title="Cerrar sesion">Salir</a>
                </div>
            </div>
        </div>
    </header>

    <!-- Player Switcher Modal -->
    <div id="player-modal" class="hidden fixed inset-0 bg-black/60 z-50 flex items-end sm:items-center justify-center">
        <div class="bg-dark-700 rounded-t-2xl sm:rounded-2xl p-5 sm:p-6 border border-gray-800 w-full sm:max-w-md sm:mx-4 max-h-[85vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-bold text-white">Cambiar Jugador</h3>
                <button onclick="hidePlayerSwitcher()" class="text-gray-500 hover:text-white text-2xl touch-target p-1">&times;</button>
            </div>
            <div id="player-list" class="space-y-2 mb-4 max-h-48 overflow-y-auto"></div>
            <div class="border-t border-gray-800 pt-4">
                <p class="text-xs text-gray-500 mb-2">Nuevo jugador:</p>
                <input id="modal-name" type="text" placeholder="Nombre" class="w-full bg-dark-900 border border-gray-700 rounded-lg px-3 py-3 text-white text-sm mb-2 focus:border-accent focus:outline-none">
                <div class="grid grid-cols-2 gap-2">
                    <input id="modal-twitter" type="text" placeholder="Twitter" class="bg-dark-900 border border-gray-700 rounded-lg px-3 py-3 text-white text-sm focus:border-accent focus:outline-none">
                    <input id="modal-instagram" type="text" placeholder="Instagram" class="bg-dark-900 border border-gray-700 rounded-lg px-3 py-3 text-white text-sm focus:border-accent focus:outline-none">
                </div>
                <div class="grid grid-cols-3 gap-2 mt-2">
                    <input id="modal-club" type="text" placeholder="Club" class="bg-dark-900 border border-gray-700 rounded-lg px-3 py-3 text-white text-sm focus:border-accent focus:outline-none">
                    <input id="modal-tm" type="text" placeholder="TM ID" class="bg-dark-900 border border-gray-700 rounded-lg px-3 py-3 text-white text-sm focus:border-accent focus:outline-none">
                    <input id="modal-tiktok" type="text" placeholder="TikTok" class="bg-dark-900 border border-gray-700 rounded-lg px-3 py-3 text-white text-sm focus:border-accent focus:outline-none">
                </div>
                <button onclick="addAndScanPlayer()" class="w-full bg-accent hover:bg-blue-600 text-white py-3 rounded-lg font-medium text-sm transition mt-3 touch-target">
                    Escanear nuevo jugador
                </button>
            </div>
        </div>
    </div>

    <!-- Setup Panel -->
    <div id="setup-panel" class="max-w-lg mx-auto mt-8 sm:mt-20 p-3 sm:p-6">
        <div class="bg-dark-700 rounded-2xl p-8 border border-gray-800">
            <div class="text-center mb-8">
                <img src="/static/logo.svg" alt="MediaPulse" class="w-16 h-16 mx-auto mb-4">
                <h2 class="text-2xl font-bold text-white">Media<span class="text-accent">Pulse</span></h2>
                <p class="text-gray-500 mt-2">Monitorizacion online de jugadores</p>
            </div>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm text-gray-400 mb-1">Nombre del jugador *</label>
                    <input id="inp-name" type="text" value="Jose Campana" placeholder="Ej: Jose Campana"
                        class="w-full bg-dark-900 border border-gray-700 rounded-lg px-4 py-3 text-white focus:border-accent focus:outline-none">
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm text-gray-400 mb-1">Twitter/X</label>
                        <input id="inp-twitter" type="text" value="JoseGCampana" placeholder="@handle"
                            class="w-full bg-dark-900 border border-gray-700 rounded-lg px-4 py-3 text-white focus:border-accent focus:outline-none">
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-1">Instagram</label>
                        <input id="inp-instagram" type="text" value="josegomezcampana24" placeholder="@handle"
                            class="w-full bg-dark-900 border border-gray-700 rounded-lg px-4 py-3 text-white focus:border-accent focus:outline-none">
                    </div>
                </div>
                <div class="grid grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm text-gray-400 mb-1">Club</label>
                        <input id="inp-club" type="text" value="AD Ceuta" placeholder="Ej: Sevilla FC"
                            class="w-full bg-dark-900 border border-gray-700 rounded-lg px-4 py-3 text-white focus:border-accent focus:outline-none">
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-1">Transfermarkt ID</label>
                        <input id="inp-tm" type="text" value="120095" placeholder="Opcional"
                            class="w-full bg-dark-900 border border-gray-700 rounded-lg px-4 py-3 text-white focus:border-accent focus:outline-none">
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-1">TikTok</label>
                        <input id="inp-tiktok" type="text" placeholder="@handle"
                            class="w-full bg-dark-900 border border-gray-700 rounded-lg px-4 py-3 text-white focus:border-accent focus:outline-none">
                    </div>
                </div>
                <button onclick="launchScan()" class="w-full bg-accent hover:bg-blue-600 text-white py-3 rounded-lg font-semibold text-lg transition mt-4">
                    Iniciar Escaneo
                </button>
            </div>
        </div>
    </div>

    <!-- Scan Progress -->
    <div id="scan-progress" class="hidden max-w-lg mx-auto mt-20 p-6">
        <div class="bg-dark-700 rounded-2xl p-8 border border-gray-800 text-center">
            <div class="scan-spinner mx-auto mb-6"></div>
            <h3 class="text-xl font-bold text-white mb-2">Escaneando...</h3>
            <p id="scan-message" class="text-gray-400">Iniciando escaneo...</p>
        </div>
    </div>

    <!-- Dashboard -->
    <div id="dashboard" class="hidden max-w-7xl mx-auto px-3 sm:px-4 py-4 sm:py-6">

        <!-- Executive Summary -->
        <div id="executive-summary" class="bg-dark-700 rounded-xl border border-gray-800 p-4 sm:p-5 mb-4 sm:mb-6 hidden">
            <div class="flex items-center justify-between mb-2">
                <h3 class="font-semibold text-white text-xs sm:text-sm uppercase tracking-wider">Resumen Ejecutivo</h3>
                <span class="text-xs text-gray-600" id="report-date"></span>
            </div>
            <p id="exec-summary-text" class="text-xs sm:text-sm text-gray-300 leading-relaxed"></p>
        </div>

        <!-- Date Range Filter (arriba para que se vea el periodo) -->
        <div id="date-range-bar" class="flex flex-wrap items-center gap-2 sm:gap-3 mb-3 sm:mb-4 bg-dark-800 rounded-xl p-2 sm:p-3 border border-gray-800">
            <span class="text-xs text-gray-500 uppercase tracking-wider">Periodo <span class="text-[9px] text-gray-600 normal-case">(hora Espana)</span>:</span>
            <div class="flex gap-1 sm:gap-2 flex-wrap">
                <button onclick="setDateRange('7d')" data-range="7d" class="date-range-btn active touch-target" data-tooltip="Ultimos 7 dias">7d</button>
                <button onclick="setDateRange('30d')" data-range="30d" class="date-range-btn touch-target" data-tooltip="Ultimos 30 dias">30d</button>
                <button onclick="setDateRange('90d')" data-range="90d" class="date-range-btn touch-target" data-tooltip="Ultimos 90 dias">90d</button>
                <button onclick="setDateRange('all')" data-range="all" class="date-range-btn touch-target" data-tooltip="Todo el historico disponible">Todo</button>
            </div>
            <div class="flex items-center gap-2 w-full sm:w-auto sm:ml-auto mt-1 sm:mt-0">
                <input type="date" id="date-from" class="bg-dark-900 border border-gray-700 rounded-lg px-2 py-2 text-xs text-white focus:border-accent focus:outline-none flex-1 sm:flex-none" onchange="setDateRange('custom')">
                <span class="text-gray-600 text-xs">a</span>
                <input type="date" id="date-to" class="bg-dark-900 border border-gray-700 rounded-lg px-2 py-2 text-xs text-white focus:border-accent focus:outline-none flex-1 sm:flex-none" onchange="setDateRange('custom')">
            </div>
        </div>

        <!-- Summary Cards -->
        <div id="summary-cards" class="grid grid-cols-2 sm:grid-cols-4 gap-2 sm:gap-4 mb-4 sm:mb-6"></div>

        <!-- Topics + Brands Row -->
        <div id="topics-brands-row" class="grid grid-cols-1 md:grid-cols-2 gap-3 sm:gap-4 mb-4 sm:mb-6 hidden">
            <div class="bg-dark-700 rounded-xl border border-gray-800 p-3 sm:p-4">
                <h4 class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-3">Temas Detectados</h4>
                <div id="topics-container" class="flex flex-wrap gap-1 sm:gap-2"></div>
            </div>
            <div class="bg-dark-700 rounded-xl border border-gray-800 p-3 sm:p-4">
                <h4 class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-3">Marcas Detectadas</h4>
                <div id="brands-container" class="flex flex-wrap gap-1 sm:gap-2"></div>
            </div>
        </div>

        <!-- Image Index -->
        <div id="image-index-card" class="hidden mb-4 sm:mb-6"></div>

        <!-- Global Search -->
        <div class="relative mb-3 sm:mb-4">
            <input type="text" id="global-search" placeholder="Buscar en todo el contenido..." class="w-full bg-dark-800 border border-gray-800 rounded-xl px-3 sm:px-4 py-3 text-sm text-white focus:border-accent focus:outline-none" oninput="debounceGlobalSearch(this.value)">
            <div id="global-search-results" class="hidden absolute top-full left-0 right-0 mt-1 bg-dark-700 border border-gray-700 rounded-xl max-h-80 overflow-y-auto z-40 shadow-xl"></div>
        </div>

        <!-- Date Range Filter (duplicado junto a tabs, oculto en mobile) -->
        <div class="date-range-secondary flex flex-wrap items-center gap-2 sm:gap-3 mb-3 sm:mb-4 bg-dark-800 rounded-xl p-2 sm:p-3 border border-gray-800">
            <span class="text-xs text-gray-500 uppercase tracking-wider">Periodo:</span>
            <div class="flex gap-1 sm:gap-2 flex-wrap">
                <button onclick="setDateRange('7d')" data-range="7d" class="date-range-btn active touch-target">7d</button>
                <button onclick="setDateRange('30d')" data-range="30d" class="date-range-btn touch-target">30d</button>
                <button onclick="setDateRange('90d')" data-range="90d" class="date-range-btn touch-target">90d</button>
                <button onclick="setDateRange('all')" data-range="all" class="date-range-btn touch-target">Todo</button>
            </div>
            <div class="flex items-center gap-2 w-full sm:w-auto sm:ml-auto mt-1 sm:mt-0">
                <input type="date" class="date-from-sync bg-dark-900 border border-gray-700 rounded-lg px-2 py-2 text-xs text-white focus:border-accent focus:outline-none flex-1 sm:flex-none" onchange="setDateRange('custom')">
                <span class="text-gray-600 text-xs">a</span>
                <input type="date" class="date-to-sync bg-dark-900 border border-gray-700 rounded-lg px-2 py-2 text-xs text-white focus:border-accent focus:outline-none flex-1 sm:flex-none" onchange="setDateRange('custom')">
            </div>
        </div>

        <!-- Tabs (desktop) -->
        <div class="desktop-tab-bar flex gap-1 mb-4 sm:mb-6 bg-dark-800 rounded-xl p-1 overflow-x-auto scrollbar-hide -mx-3 sm:mx-0 px-3 sm:px-1">
            <button onclick="switchTab('prensa')" data-tab="prensa" class="tab-btn active px-3 sm:px-4 py-2.5 sm:py-2 rounded-lg text-xs sm:text-sm font-medium whitespace-nowrap touch-target" data-tooltip="Noticias de prensa deportiva digital" data-tooltip-pos="below">Prensa</button>
            <button onclick="switchTab('redes')" data-tab="redes" class="tab-btn px-3 sm:px-4 py-2.5 sm:py-2 rounded-lg text-xs sm:text-sm font-medium whitespace-nowrap touch-target" data-tooltip="Menciones de terceros en redes sociales" data-tooltip-pos="below">Menciones</button>
            <button onclick="switchTab('actividad')" data-tab="actividad" class="tab-btn px-3 sm:px-4 py-2.5 sm:py-2 rounded-lg text-xs sm:text-sm font-medium whitespace-nowrap touch-target" data-tooltip="Publicaciones propias del jugador" data-tooltip-pos="below">Sus Redes</button>
            <button onclick="switchTab('alertas')" data-tab="alertas" class="tab-btn px-3 sm:px-4 py-2.5 sm:py-2 rounded-lg text-xs sm:text-sm font-medium whitespace-nowrap touch-target" data-tooltip="Alertas automaticas basadas en umbrales: prensa negativa, redes negativas, trending, fichajes, lesiones, polemicas e inactividad" data-tooltip-pos="below">Alertas <span id="alert-badge" class="hidden ml-1 bg-red-500 text-white text-xs px-1.5 py-0.5 rounded-full"></span></button>
            <button onclick="switchTab('historial')" data-tab="historial" class="tab-btn px-3 sm:px-4 py-2.5 sm:py-2 rounded-lg text-xs sm:text-sm font-medium whitespace-nowrap touch-target" data-tooltip="Historial de escaneos y comparacion" data-tooltip-pos="below">Historial</button>
            <button onclick="switchTab('historico')" data-tab="historico" class="tab-btn px-3 sm:px-4 py-2.5 sm:py-2 rounded-lg text-xs sm:text-sm font-medium whitespace-nowrap touch-target" data-tooltip="Graficos de evolucion temporal" data-tooltip-pos="below">Graficos</button>
            <button onclick="switchTab('inteligencia')" data-tab="inteligencia" class="tab-btn px-3 sm:px-4 py-2.5 sm:py-2 rounded-lg text-xs sm:text-sm font-medium whitespace-nowrap touch-target" data-tooltip="Analisis estrategico de riesgos por IA: narrativas, tendencias, stats, valor de mercado y colaboraciones" data-tooltip-pos="below">Inteligencia <span id="risk-badge" class="hidden ml-1 text-xs px-1.5 py-0.5 rounded-full"></span></button>
            <button onclick="switchTab('informe')" data-tab="informe" class="tab-btn px-3 sm:px-4 py-2.5 sm:py-2 rounded-lg text-xs sm:text-sm font-medium whitespace-nowrap touch-target" data-tooltip="Informes semanales con recomendaciones" data-tooltip-pos="below">Informe</button>
        </div>

        <!-- Tab Content -->
        <div id="tab-prensa" class="tab-content"></div>
        <div id="tab-redes" class="tab-content hidden"></div>
        <div id="tab-actividad" class="tab-content hidden"></div>
        <div id="tab-alertas" class="tab-content hidden"></div>
        <div id="tab-historial" class="tab-content hidden"></div>
        <div id="tab-historico" class="tab-content hidden"></div>
        <div id="tab-inteligencia" class="tab-content hidden"></div>
        <div id="tab-informe" class="tab-content hidden"></div>
    </div>

    <!-- Portfolio View -->
    <div id="portfolio-view" class="hidden max-w-7xl mx-auto px-3 sm:px-4 py-4 sm:py-6">
        <div class="flex items-center justify-between mb-4 sm:mb-6">
            <h2 class="text-lg sm:text-2xl font-bold text-white">Portfolio</h2>
            <div class="flex items-center gap-2">
                <button id="btn-compare-players" onclick="showPlayerCompareModal()" class="bg-dark-700 hover:bg-dark-600 text-gray-300 px-3 py-2 rounded-lg text-xs sm:text-sm border border-gray-700 touch-target">Comparar</button>
                <button onclick="hidePortfolio()" class="bg-dark-700 hover:bg-dark-600 text-gray-300 px-3 py-2 rounded-lg text-xs sm:text-sm border border-gray-700 touch-target">Volver</button>
            </div>
        </div>
        <div id="portfolio-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4"></div>
    </div>

    <!-- Player Compare Modal -->
    <div id="player-compare-modal" class="hidden fixed inset-0 bg-black/60 z-50 flex items-end sm:items-center justify-center">
        <div class="bg-dark-700 rounded-t-2xl sm:rounded-2xl p-4 sm:p-6 border border-gray-800 w-full sm:max-w-4xl sm:mx-4 max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-base sm:text-lg font-bold text-white">Comparativa de Jugadores</h3>
                <button onclick="hidePlayerCompareModal()" class="text-gray-500 hover:text-white text-2xl touch-target p-1">&times;</button>
            </div>
            <div id="player-compare-content"></div>
        </div>
    </div>

    <!-- Mobile Bottom Navigation -->
    <nav class="mobile-bottom-nav" id="mobile-nav">
        <button onclick="switchTab('prensa')" data-tab="prensa" class="active">
            <span class="nav-icon">üì∞</span>Prensa
        </button>
        <button onclick="switchTab('redes')" data-tab="redes">
            <span class="nav-icon">üí¨</span>Menciones
        </button>
        <button onclick="switchTab('actividad')" data-tab="actividad">
            <span class="nav-icon">üì±</span>Sus Redes
        </button>
        <button onclick="switchTab('inteligencia')" data-tab="inteligencia">
            <span class="nav-icon">üß†</span>Intel
        </button>
        <button onclick="switchTab('alertas')" data-tab="alertas">
            <span class="nav-icon">‚ö†Ô∏è</span>Alertas
        </button>
    </nav>

    <script src="/static/app.js"></script>
</body>
</html>
